<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.last.prj.pet.service.PetMapper">

	<select id="petOne" parameterType="int"
		resultType="com.last.prj.pet.service.PetVO">
		SELECT *
		FROM pet
		WHERE pet_no = #{pet_no}
	</select>
	
	<!-- 예약 품종코드 조회(중복제거) -->
	<select id="petCodeSearch" parameterType="String" resultType="com.last.prj.pet.service.PetVO">
		SELECT DISTINCT code FROM  PET
		WHERE
		M_ID = #{m_id}
	</select>
	

	<!-- 일반회원 반려동물 조회 -->
	<select id="petmemberList" parameterType="String"
		resultType="com.last.prj.pet.service.PetVO">
		SELECT * FROM PET
		WHERE
		M_ID = #{m_id}
	</select>
	
	<!-- 펫 상세정보 조회 -->
	<select id="petSearch" parameterType="int"
		resultType="com.last.prj.pet.service.PetVO">
		SELECT p.NAME, p.R_CHECK, p.GENDER, p.M_ID, p.BIRTH, c.content AS c_content, p.WEIGHT, p.N_CONTENT, p.PICTURE, p.PFILE
		FROM PET p, f_code c
		WHERE P.CODE=C.CODE AND PET_NO = #{pet_no}
	</select>

	
	<insert id="mypetInsert" parameterType="com.last.prj.pet.service.PetVO">
		<selectKey keyProperty="pet_no" resultType="int" order="BEFORE">
			 SELECT NVL(MAX(PET_NO) +1 , 1) AS PET_NO FROM PET
		</selectKey>
	
	INSERT INTO PET (PET_NO, NAME, BIRTH, GENDER, M_ID, CODE, WEIGHT, N_CONTENT, PICTURE, PFILE)
    VALUES(#{pet_no},#{name},#{birth},#{gender},#{m_id},#{code}, #{weight},#{n_content},#{picture},#{pfile})
	
	
	</insert>
		
	
	<!-- 펫 수 -->
	<select id="petCount" resultType="int">
		SELECT COUNT(*) FROM PET
	</select>
	
	<!-- 펫 검색 -->
	<select id="petProtoColSearch" parameterType="String" resultType="com.last.prj.pet.service.PetVO" >
		SELECT * FROM(
        			SELECT PM.NAME AS pm_name, S.CONTENT, P.NAME AS P_NAME, S.startdate, PM.CODE AS pm_code
					FROM SERVICE S, RESERVATION R, PET P, P_MEMBER PM
					WHERE S.R_NO = R.R_NO AND
						  P.PET_NO = R.PET_NO AND
						  R.P_ID = PM.P_ID AND
						  P.M_ID = #{m_id}  
		<if test="key == 'all'">AND  p.NAME LIKE '%'|| #{data}||'%'</if>
		
		
		UNION
		SELECT PM.NAME AS pm_name, D.D_NAME AS content,
		P.NAME AS p_name, D.W_DATE AS startdate, PM.CODE AS pm_code
		FROM
		DIAGNOSIS D, RESERVATION R, PET P, P_MEMBER PM
		WHERE D.R_NO = R.R_NO
		AND P.PET_NO = R.PET_NO AND R.P_ID = PM.P_ID AND
		P.M_ID = #{m_id}  
		<if test="key == 'all'">AND p.NAME LIKE '%'|| #{data}||'%'</if>
        )	
		
	</select>
	
</mapper>