<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.last.prj.pmember.service.PmemberMapper">
	<!-- 파트너 리스트출력 -->
	<select id="memberList" parameterType="int" resultType="com.last.prj.pmember.service.PmemberVO">
		SELECT P.P_ID, P.NAME, F.PICTURE
		FROM P_MEMBER P, F_FILE F
		WHERE F.W_WRITE = P.P_ID AND F.F_PART = P.P_PROFILE AND P.CODE = #{code}
	</select>
	
	<!-- 지역검색 -->
	<select id="memberSelect" parameterType="map" resultType="com.last.prj.pmember.service.PmemberVO">
		SELECT P.NAME,F.PICTURE
		FROM P_MEMBER P, F_FILE F
		WHERE F.W_WRITE = P.P_ID AND P.P_PROFILE = F.F_PART AND W_ADDRESS LIKE '%'||#{param}||'%' AND P.CODE = #{code} 
	</select>
	
	<resultMap type="com.last.prj.pmember.service.PmemberVO"
		id="pmembervo">
		<result column="p_id" property="p_id" />
		<result column="name" property="name" />
		<result column="n_content" property="n_content" />
		<result column="w_name" property="w_name" />
		<result column="w_address" property="w_address" />
		<result column="w_tel" property="w_tel" />
		<result column="p_info" property="p_info" />
		<result column="w_d_address" property="w_d_address" />
		<result column="career" property="career" />
		<collection property="timeList" resultMap="TimeVO" />
	</resultMap>

	<resultMap type="com.last.prj.pmember.service.TimeVO"
		id="TimeVO">
		<result column="w_day" property="w_day" />
		<result column="starttime" property="starttime" />
		<result column="endtime" property="endtime" />
		<result column="n_content" property="n_content" />
	</resultMap>
	<!-- 상세페이지 -->
	<select id="getMember" parameterType="String"
		resultMap="pmembervo"
		resultType="com.last.prj.pmember.service.PmemberVO">
		SELECT *
		FROM P_MEMBER P, O_TIME T
		WHERE P.P_ID = T.P_ID AND P.P_ID = #{p_id}
	</select>
	<!-- 파트너 프로필사진 -->
	<select id="getPicture" parameterType="String" resultType="com.last.prj.pmember.service.FfileVO">
		SELECT F.PICTURE
		FROM P_MEMBER P , F_FILE F
		WHERE P.P_ID = F.W_WRITE AND P_ID = #{p_id}
	</select>
	<!-- 상담리뷰 -->
	<select id="getCounselReview" parameterType="String"  resultType="com.last.prj.pmember.service.ReviewVO">
		SELECT RE.CONTENT, RE.RATING, M.M_ID
		FROM REVIEW RE, COUNSEL C , PET P, MEMBER M
		WHERE RE.C_NO =C.C_NO AND C.PET_NO = P.PET_NO AND P.M_ID = M.M_ID AND C.P_ID = #{p_id}
	</select>
	<!-- 서비스리뷰 -->
	<select id="getServiceReview" parameterType="String"  resultType="com.last.prj.pmember.service.ReviewVO">
		SELECT RE.CONTENT, RE.RATING, M.M_ID
		FROM RESERVATION R, REVIEW RE, PET P, MEMBER M
		WHERE RE.R_NO = R.R_NO AND R.PET_NO = P.PET_NO AND P.M_ID = M.M_ID AND R.P_ID = #{p_id}
	</select>
	<!-- 리뷰회원 프로필사진 -->
	<select id="getProfile" parameterType="String" resultType="com.last.prj.pmember.service.FfileVO">	
		SELECT F.PICTURE, F.F_PART
		FROM MEMBER M , F_FILE F
		WHERE M.M_ID = F.W_WRITE AND M_ID =#{m_id}
	</select>
	
	
	
	<!-- 관리자 -->
	<select id = "admPlistCode" parameterType="int" resultType="com.last.prj.pmember.service.PmemberVO">
		SELECT *
		FROM P_MEMBER P, F_FILE F
		WHERE F.W_WRITE = P.P_ID AND F.F_PART = P.P_PROFILE AND P.CODE = #{code}
	</select>
	
	<select id="admPlist" resultType="com.last.prj.pmember.service.PmemberVO">
		SELECT P.P_ID, P.TEL,P.STARTDATE, P.C_REPORT, P.NAME, F.CONTENT as f_content
		FROM P_MEMBER P , F_CODE F 
		WHERE F.CODE=P.CODE
	</select>	
	
</mapper>