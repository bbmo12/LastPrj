<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.last.prj.counsel.service.CounselMapper">
	<select id="myCounselList" parameterType="String" resultType="com.last.prj.counsel.service.CounselVO">
		SELECT P.NAME AS p_name, PM.NAME AS pm_name, C.CONTENT, CO.CONTENT AS co_content, C.W_DATE, R.R_CHECK
		FROM P_MEMBER PM, PET P, COUNSEL C, F_CODE CO, REVIEW R
		WHERE PM.P_ID = C.P_ID AND C.PET_NO= P.PET_NO AND CO.CODE = C.CODE AND
		R.C_NO = C.C_NO AND P.M_ID = #{m_id}
	</select>
	
	<!-- 파트너회원상담 total -->
	<select id="counselPage" resultType="int" parameterType="com.last.prj.counsel.service.CounselVO">
	 	SELECT COUNT(*) AS TOTAL 
     		FROM COUNSEL
      	WHERE P_ID = #{p_id}
	</select>
	
	<select id="counselList" resultType="com.last.prj.counsel.service.CounselVO">
		 SELECT *
      		FROM ( SELECT ROWNUM RN, A.*
     		        FROM (SELECT P.NAME AS p_name, P.M_ID, C.CONTENT, C.W_DATE, C.CODE, C.C_NO
      				        FROM PET P, MEMBER M, COUNSEL C
       				      WHERE P.PET_NO = C.PET_NO AND P.M_ID = M.M_ID AND P_ID = #{p_id} ORDER BY C_NO      				  
       				      ) A)
      		WHERE RN BETWEEN (#{pageNum}-1)*#{amount}+1
		    AND (#{pageNum})*#{amount}	
	</select> 
   
  
</mapper>