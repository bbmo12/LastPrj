<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.last.prj.report.service.ReportMapper">

	<!-- qna 신고 접수 -->
	<insert id="newQnaReport"
		parameterType="com.last.prj.report.service.ReportVO"> 		
		INSERT INTO REPORT (rep_no, reporter, w_date, content, q_no, reported, code)
		VALUES (r_seq.nextval, #{reporter}, sysdate, #{content}, #{q_no}, #{reported}, #{code})
	</insert>


	<!-- 신고 유형 별 리스트 -->
	<select id="reportPartlist">
		SELECT * FROM REPORT
	</select>



	<!-- 신고전체 리스트 -->
	<select id="reportList" resultType="com.last.prj.report.service.ReportVO">
		SELECT R.REP_NO, R.REPORTER,R.REPORTED, R.W_DATE, R.CONTENT, F.CONTENT AS F_CONTENT, r.rev_no, r.q_no
			FROM REPORT R, F_CODE F
			WHERE R.CODE = F.CODE
			ORDER BY R.REP_NO
	</select>
	
	<!-- 신고 전체 건수 -->
	<select id="reportCount" resultType="int">
		SELECT COUNT(*) FROM REPORT
	</select>
	
	<!-- review 신고 리스트 -->
	<select id="reviewList" resultType="com.last.prj.report.service.ReportVO">
		SELECT F.CONTENT AS F_CONTENT, R.REPORTER, R.REPORTED,RE.REV_NO,R.REP_NO,R.REPOR, R.W_DATE, R.CONTENT
		FROM REPORT R, F_CODE F, REVIEW RE
		WHERE R.CODE = F.CODE AND R.REV_NO = RE.REV_NO
	</select>
	
	<!-- qna 신고 리스트 -->
	<select id="admQnaList" resultType="com.last.prj.report.service.ReportVO">
		SELECT F.CONTENT AS F_CONTENT, R.CONTENT, R.REPORTER, R.REPORTED, Q.Q_NO,R.W_DATE,R.REP_NO,R.REPOR
		FROM REPORT R, F_CODE F, QNA Q
		WHERE R.CODE = F.CODE AND R.Q_NO = Q.Q_NO

	</select>
	

	<!-- 신고 유형에 따른 신고 및 건수 -->
	<select id="reportPartCount" parameterType="int" resultType="com.last.prj.report.service.ReportVO">
		SELECT R.CODE AS CODE, F.CONTENT AS CONTENT, COUNT(F.CODE) AS COUNT
		FROM F_CODE F, REPORT R
		WHERE R.CODE=F.CODE AND F.CODE = {code}
		GROUP BY F.CODE,F.CONTENT,R.CODE 

	</select>


</mapper>